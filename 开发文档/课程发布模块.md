### 遗留的问题
- 在处理页面静态化任务中，上传静态化页面到MinIo需要远程调用。为确保不发生微服务雪崩，配置熔断降级，使用hystrix配置熔断降级处理不生效，后面有时间处理，可能是Spring Cloud版本太高，与hystrix不兼容；
- Elasticsearch搜索的代码要仔细阅读
- 课程发布后，上传到MinIo的静态页面信息应该从课程发布表中获取课程的相关信息，而不是从基本信息表中重新获取



### Day8
#### 01
课程预览，使用模板引擎技术，查询数据库数据填充到模板返回给前端。

#### 02 课程审核接口
使用预发布表，解决课程审核的同时用户需要修改课程信息的需求。

#### 03-04 分布式事务
**本地事务**
基于应用自己的关系型数据库的事务被称为本地事务
**分布式事务**
在分布式系统环境下，通过与不同的服务进行网络通信去完成事务称之为分布式事务。不同服务与数据库简历的连接不同。

#### 05 CAP理论
CAP定理（CAP Theorem）是分布式系统中的一个基本定理，它描述了在分布式计算中一致性、可用性和分区容错性三大特性之间的权衡关系。
- 一致性（Consistency）：所有节点在同一时间下的数据保持一致，任何对数据的读取操作都能返回最新写入的数据。这意味着系统要保证所有的写操作都能在所有副本上同步完成。
- 可用性（Availability）：每次请求都能得到响应，无论请求是否成功执行。即系统能够保证每次请求都能返回某种结果，即使这不是最新的数据。
- 分区容错性（Partition Tolerance）：系统能够容忍网络分区故障，在出现网络分裂时依然能够继续工作。这意味着即使网络通信中断，不同节点仍能独立处理请求。
根据CAP定理，一个分布式系统不可能同时完全满足一致性、可用性和分区容错性这三大特性，只能在这三者之间进行权衡。例如，**常见的分布式系统设计通常选择在一致性和可用性之间做出取舍**，同时确保系统具备分区容错性。

**BASE理论**
BASE 是 Basically Available(基本可用)、Soft state(软状态)和 Eventually consistent (最终一致性)三个短语的缩写。
基本可用：当系统无法满足全部可用时保证核心服务可用即可，比如一个外卖系统，每到中午12点左右系统并发量很高，此时要保证下单流程涉及的服务可用，其它服务暂时不可用。
软状态：是指可以存在中间状态，比如：打印自己的社保统计情况，该操作不会立即出现结果，而是提示你打印中，请在XXX时间后查收。虽然出现了中间状态，但最终状态是正确的。
最终一致性：退款操作后没有及时到账，经过一定的时间后账户到账，舍弃强一致性，满足最终一致性。

#### 06 分布式事务控制方案
预发布任务包含的：写入预发布表、存入Redis做缓存、写入Elasticsearch做课程索引、上传静态页面到MinIo，
对一致性要求不高，只需保证最终一致性即可，因此我们采用xxl-job定时任务，课程发布信息写入发布信息表后，
将课程发布任务消息写入消息表，定时处理消息表中的消息。

#### 08 消息SDK
提取一个公共的消息模块，处理消息。其他微服务模块需要使用时，直接引入即可。
采用了模板设计模式。

#### 09 任务调度

### Day09
#### 01 页面静态化
**什么是页面静态化？**
课程预览功能通过模板引擎技术在页面模板中填充数据，生成html页面，这个过程是当客户端请求服务器时服务器才开始渲染生成html页面，最后响应给浏览器，服务端渲染的并发能力是有限的。
页面静态化则强调将生成html页面的过程提前，提前使用模板引擎技术生成html页面，当客户端请求时直接请求html页面，由于是静态页面可以使用nginx、apache等高性能的web服务器，并发性能高。

**远程调用**
微服务之间难免会存在远程调用，在Spring Cloud中可以使用Feign进行远程调用，
Feign是一个声明式的http客户端，其作用就是帮助我们优雅的实现http请求的发送，解决上面提到的问题。

#### 02 熔断降级
**微服务雪崩效应**
微服务中难免存在服务之间的远程调用，比如：内容管理服务远程调用媒资服务的上传文件接口，当微服务运行不正常会导致无法正常调用微服务，此时会出现异常，如果这种异常不去处理可能导致雪崩效应。
微服务的雪崩效应表现在服务与服务之间调用，当其中一个服务无法提供服务可能导致其它服务也死掉，比如：服务B调用服务A，由于A服务异常导致B服务响应缓慢，最后A、B等服务都不可用，**像这样由一个服务所引起的一连串的多个服务无法提供服务即是微服务的雪崩效应**

**熔断与降级**
熔断：
当下游服务异常而断开与上游服务的交互，它就相当于保险丝，下游服务异常触发了熔断，从而保证上游服务不受影响。
降级：
当下游服务异常触发熔断后，上游服务就不再去调用异常的微服务而是执行了降级处理逻辑，这个降级处理逻辑可以是本地一个单独的方法。

#### 04 课程搜索
全文检索是指计算机索引程序通过扫描文章中的每一个词，**对每一个词建立一个索引，指明该词在文章中出现的次数和位置**，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。

Elasticsearch索引原理：倒排索引

